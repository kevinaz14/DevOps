- hosts: webservers
  tasks:
    - name: Install IIS (Web-Server only)
      win_feature:
        name: Web-Server
        state: present
        
    - name: create Temp directory
      win_file:
        path: C:\temp
        state: directory
    
    - name: Copy certificate
      win_copy:
        src: /home/WMA_Admin/wma.westeurope.cloudapp.azure.com.pfx
        dest: C:\temp\wma.westeurope.cloudapp.azure.com.pfx
        
    - name: import certificate
      win_certificate_store:
        path: C:\temp\wma.westeurope.cloudapp.azure.com.pfx
        state: present
        password: P@ssw0rd2018
      become: yes
      become_method: runas
      
    - name: Add HTTPS binding
      win_iis_webbinding:
        name: Default Web Site
        protocol: https
        port: 443
        host_header: wma.westeurope.cloudapp.azure.com
        ssl_flags: 1
        certificate_hash: 712a3ccf4cf6ecb8747722b972ff6b0a291ac2b0
        state: present
